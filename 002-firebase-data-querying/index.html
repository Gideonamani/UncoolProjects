<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

	<title> Uncool Projects | Firebase Querying </title>
		
	<script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
	<script>
	  // Initialize Firebase
	  var config = {
	    apiKey: "AIzaSyA9qbEIGZh8B9dpFCgeDk9kj3gD3kuYXkA",
	    authDomain: "gideonamaniaudioproject01.firebaseapp.com",
	    databaseURL: "https://gideonamaniaudioproject01.firebaseio.com",
	    projectId: "gideonamaniaudioproject01",
	    storageBucket: "gideonamaniaudioproject01.appspot.com",
	    messagingSenderId: "282223454104"
	  };
	  firebase.initializeApp(config);
	</script>

	<style type="text/css">
		body {
			font-family: sans-serif;
		}
		h1, h2, h3, h4, h5, h6, p {
			padding: 0;
			border: 0;
			margin: 0;
		}
		p {
			padding: 4px 8px;
			font-size: 1.2rem;
		}
		p span {
			padding: 0 2px;
		    background: azure;	
	        margin: 0 4px;		
		}
		header h2 {
			border-bottom: solid lightgray 1px;
			margin-bottom: 8px;
		}
		.container {
			max-width: 800px;
			margin: 0 auto;
		}
		.card {
		    /* background: #fbfbfb; */
		    border-radius: 4px;
		    margin: 0 4px;
		    margin-bottom: 8px;
		    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
		}
		.card .first-name {

		}

		.card .last-name {

		}
		.footnote p {
			display: inline-block;
		}
		.footnote .age-number {

		}
		.footnote .year-joined {

		}
		.query-section {
			border: solid #00BCD4 1px;
			border-radius: 4px;
			padding: 2px;
			margin: 8px 0;
		}
		.query-headline {
		    border-bottom: dotted gray 1px;
		    margin: 4px 0;
		}
		.query-highlight {
			border: solid turquoise 1px;
			border-radius: 2px;
			background-color: paleturquoise;
		}
		pre.test-data {
			/*background-color: whitesmoke;*/
			color: #607D8B;
			padding: 20px;
			border-radius: 4px;
		}
		.input-item {
			margin: 8px 0;
			border-bottom: solid #ddd 1px;
			padding-bottom: 2px;
		}
		.input-item input, .input-item select {
			box-sizing: border-box;
			width: 100%;
			border: solid #444 1px;
			border-radius: 2px;
			padding: 4px;
			font-size: 1rem;
		}
		.input-item span {
			display: inline-block;
			width: 45%;
		}
		.input-item span input[type="checkbox"] {
			width: auto;
			margin-left: 8px;
		}
		button#run-query {
			width: 80%;
			max-width: 400px;
			padding: 4px;
			font-size: 1.1rem;
			font-weight: 500;
			background: linear-gradient(darkturquoise, #8af2ff);
			border: solid turquoise 2px;
			border-radius: 4px;
			color: #4e4e4e;
			text-transform: uppercase;		
		}
	</style>

</head>
<body>
	<div class="container">
		<header>
			<h2>Querying with Firebase</h2>
		</header>



		<!-- I) THE TEST DATA -->
		<div class="query-section">
			<h3 class="query-headline">
				The test data.
			</h3>
			<pre class="test-data">
{
	"11": {
			"firstName": "Blue",
			"lastName": "Azure",
			"age": "34",
			"yearJoined": 20
		},
	"22": {
			"firstName": "Eldo",
			"lastName": "Jupiter",
			"age": "9",
			"yearJoined": 21
		},
	"33": {
			"firstName": "Canny",
			"lastName": "Zoo",
			"age": "3",
			"yearJoined": 19
		},
	"44": {
			"firstName": "Antonio",
			"lastName": "Kane",
			"age": "6",
			"yearJoined": 14
		},
	"55": {
			"firstName": "Mustafi",
			"lastName": "Joe",
			"age": "66",
			"yearJoined": 12
		}
}
			</pre>
		</div>



		<!-- II) QUERY INPUTS -->
		<div class="query-section">
			<h3 class="query-headline">
				Query Tweak Knobs
			</h3>
			<div class="input-item">
				<label>
					<p> Order Type </p>
					<select>
						<option value="volvo">Child</option>
						<option value="saab">Key</option>
						<option value="mercedes">Value</option>
					</select>
				</label>
			</div>

			<div class="input-item" id="child-options">
				<label>
					<p> Order by child options </p>
					<select>
						<option value="volvo">Age</option>
						<option value="saab">First Name</option>
						<option value="mercedes">Last Name</option>
						<option value="mercedes">Year Joined</option>
					</select>
				</label>
			</div>

			<div class="input-item">
				<label>
					<p> Limit to the first </p>
					<input type="number" name="" step="1" min="0" max="5">
				</label>
			</div>

			<div class="input-item">
					<p> Highlight Query </p>
					<span>
						<label>
							Yes
							<input type="checkbox" name="">
						</label>
					</span>
					<span>
						<label>
							No
							<input type="checkbox" name="">
						</label>
					</span>
				</label>
			</div>

			<div class="input-item" style="text-align: center;">
				<button id="run-query">Send</button>
			</div>


		</div>



		<!-- III) QUERY RESULTS -->
		<!-- query data -->
		<div id="query-results">
			
		</div>



		<!-- query function code -->



		<!-- IV) QUERY EXPLANATON -->
		<!-- some query order explanations -->
		<div class="query-section">
			<h3 class="query-headline">
				Short Explanation
			</h3>
			<p>
				Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
				tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
				quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
				consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
				cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
				proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
			</p>
		</div>



	</div>


	<script type="text/javascript">
		// starting script for Firebase docs https://firebase.google.com/docs/database/security/indexing-data,
		// https://firebase.google.com/docs/database/web/lists-of-data
		// var myUserId = firebase.auth().currentUser.uid;
		// var topUserPostsRef = firebase.database().ref('user-posts/' + myUserId).orderByChild('starCount');
		var d_ref = firebase.database().ref('deadlines').orderByChild('deadlineDate').limitToFirst(1);
		d_ref.once('value').then(snap => console.log( snap.val() ) );
		// d_ref.once('value', snap => console.log( snap.val() ) );


		// var c_ref = firebase.database().ref('deadlines').orderByChild('criticalLevel').limitToFirst(1);
		// c_ref.once('value').then(snap => console.log( "lowest CL:", snap.val() ) );

		// var c_ref = firebase.database().ref('deadlines').orderByChild('criticalLevel');
		// c_ref.once('value').then(snap => printJSON( snap.val() ) );

		// var obk_ref = firebase.database().ref('deadlines/787878').orderByKey().limitToFirst(1);
		// obk_ref.once('value').then(snap => console.log( "lowest key:", snap.val() ) );

		// var obv_ref = firebase.database().ref('deadlines/787878').orderByValue().limitToFirst(1);
		// obv_ref.once('value').then(snap => console.log( "lowest value:", snap.val() ) );

// Lexicographical: Mind that strings are treated differently to numbers,
// "80000" < 3
// Also be careful of nulls, try to ensure that they are non-existant since 
// nodes with null will rank lower to any other node with some data
		// var json = {
		// 	"787878": {
		// 		"deadlineDate": "999999",
		// 		"postDate": "780000",
		// 		"criticalLevel": "2"
		// 	},
		// 	"667878": {
		// 		"deadlineDate": "881818",
		// 		"postDate": "660000",
		// 		"criticalLevel": "1"
		// 	},
		// 	"447878": {
		// 		"deadlineDate": "772233",
		// 		"postDate": "440000",
		// 		"criticalLevel": "2"
		// 	},
		// 	"227878": {
		// 		"deadlineDate": "998888",
		// 		"postDate": "220000",
		// 		"criticalLevel": "3"
		// 	},
		// }

		var json = {
			"11": {
				"firstName": "Blue",
				"lastName": "Azure",
				"age": "34",
				"yearJoined": 20
			},
			"22": {
				"firstName": "Eldo",
				"lastName": "Jupiter",
				"age": "9",
				"yearJoined": 21
			},
			"33": {
				"firstName": "Canny",
				"lastName": "Zoo",
				"age": "3",
				"yearJoined": 19
			},
			"44": {
				"firstName": "Antonio",
				"lastName": "Kane",
				"age": "6",
				"yearJoined": 14
			},
			"55": {
				"firstName": "Mustafi",
				"lastName": "Joe",
				"age": "66",
				"yearJoined": 12
			}
		};




		function printJSON(json){
			for (var key in json) {
			  if (json.hasOwnProperty(key)) {
			    console.log(key + " -> " + json[key]);
			  }
			}
		}

		function displayJSON(json){
			var containerDiv = document.querySelector(".container");
			for (var key in json) {
				if(json.hasOwnProperty(key)){
					var cardDiv = document.createElement("DIV");
					cardDiv.classList.add("card");
					var htmlText = `
							<p><span class="first-name"> ${json[key].firstName} </span> <span class="last-name"> ${json[key].lastName}</span> </p>
							<div class="footnote">
								<p>Age: <span class="age-number">${json[key].age}</span></p>
								<p>Joined: '<span class="year-joined">${json[key].yearJoined}</span></p>
							</div>` ;
					cardDiv.innerHTML = htmlText;
					containerDiv.append(cardDiv);
				}
			}
		}

		function displaySortedJSON(json, sortProperty, descending){
			var queryResultsDiv = document.querySelector("#query-results");
			var querySectionDiv = document.createElement("DIV");
			querySectionDiv.classList.add("query-section");

			var queryHeadline = document.createElement("H3");
			queryHeadline.classList.add("query-headline");
			queryHeadline.textContent = "Query sorted by: " + sortProperty;
			querySectionDiv.append(queryHeadline);

			var array = Object.keys(json).map(x => json[x]);
			array.sort(function(a, b) {
				if(!descending){
				    return a[sortProperty] - b[sortProperty];
				}else{
					return b[sortProperty] - a[sortProperty];
				}
			});


			console.log(array);
			array.forEach(function(objectItem){
				
				var cardDiv = document.createElement("DIV");
				cardDiv.classList.add("card");
				var htmlText = `
						<p><span class="first-name"> ${objectItem.firstName} </span> <span class="last-name"> ${objectItem.lastName}</span> </p>
						<div class="footnote">
							<p>Age: <span class="age-number">${objectItem.age}</span></p>
							<p>Joined: '<span class="year-joined">${objectItem.yearJoined}</span></p>
						</div>` ;
				cardDiv.innerHTML = htmlText;
				querySectionDiv.append(cardDiv);				
			});

			queryResultsDiv.append(querySectionDiv);
		}


		function getFromDB(childToOrder){
			var ref = firebase.database().ref('queryTest').orderByChild(childToOrder);
			ref.on('value', function(snap){
				displaySortedJSON( snap.val(), childToOrder );
			});
		}

		getFromDB("age");
	</script>
</body>
</html>