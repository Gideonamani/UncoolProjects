<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
	<link rel="manifest" href="../manifest.json">
	<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
	<meta name="theme-color" content="#f5f5f5">

    <title> Test </title>

	<link rel="stylesheet" type="text/css" href="../css/main.css">
</head>

<body>
	<header>
		
	</header>

	<div class="container">
		<div class="questions-wrapper">

		</div>
	</div>

	<div class="paginator-wrapper">
		<div class="paginator">
			<button id="prev-question">PREV</button>
			<div class="center-content">
				<div>
					<progress value="0" max="100">
				</div>
				<div>
					<p>Page: <span id="page-index"> </span></p>
				</div>
				<button id="submit-for-evaluation"> Submit Test for Evaluation </button>
			</div>
			<button id="next-question">NEXT</button>
		</div>
		<div class="confirm-evaluation">
			<div>
				<p>Not all questions are answered. Are you sure you want to proceed with evaluation?</p>
				<button id="cancel-submition">CANCEL</button>
				<button id="confirm-submition">EVALUATE</button>
			</div>

			<div>
				<label>
					<p>Highlight options on unanswered question?</p>
					<input id="highlight-unanswered" type="checkbox" name="">
				</label>
			</div>
		</div>
	</div>

	<footer>
		
	</footer>


    <div class="page-spinner">
        <div class="spinner">
            <p>Loading...</p>
            <div class="cube1"></div>
            <div class="cube2"></div>
        </div>
    </div>

	<div class="templates" style="display: none;">
		<div class="question-wrapper">
			<section class="question">
				<p class="question-text"></p>
				<div class="image-wrapper">
					<img src="">
				</div>
			</section>

			<section class="options">
			</section>
		</div>

		<label class="option-item">
			<div class="option">
				<div class="option-marker">
					<input type="radio" name="b">
				</div>
				<div class="option-content">
					<div class="image-wrapper">
						<img src="">
					</div>
					<p class="option-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit laborum.</p>
				</div>
			</div>
		</label>
			

		<div class="report-question-wrapper question-wrapper">
			<h3 class="question-number">Question <span class="figure"></span>: 
				<span class="question-evaluation-status"></span>
			</h3>
			<p class="question-text"></p>
			<div class="image-wrapper">
				<img src="">
			</div>

			<ul class="answers">
				<p> Answer:</p>
			</ul>

			<ul class="correct">
				<p> Correct:</p>
			</ul>

			<ul class="incorrect">
				<p> Incorrect:</p>
			</ul>
		</div>
		
	</div>



	<div class="results-wrapper">
		<div class="container results">
			<h2>Your test score is:</h2>

			<div class="test-mark ok">
				<h1>
					<span id="test-score">78</span> %
				</h1>
			</div>

			<div class="further-options">
				<button onclick="retakeTest()">Repeat test</button>
				<button id="show-full-report">Show Full Report</button>
				<button onclick="takeDifferentTest()">Take different Test</button>
			</div>
		</div>
	</div>

	<div class="full-report-wrapper">
		<!-- <header><button>Close</button></header> -->
		
		<div class="container full-report">
		</div>

		<footer><button onclick="hideFullReport()">Close</button></footer>
	</div>


	<script src="../js/main.js" type="text/javascript"></script>
	<script type="text/javascript">
		showLoading();
	</script>
	<script src="../js/class-question.js" type="text/javascript"></script>
	<script src="../js/class-test.js" type="text/javascript"></script>
	<script type="text/javascript">
        const url_string = window.location.href; 
        const url = new URL(url_string);
        const jsonName = url.searchParams.get("json");
        const jsonPath = "../json/"+jsonName+".json";

        getJSON(jsonPath).then( json => {
        	console.log(jsonPath, "\n", "Data:", json );
        	initTestApp(json);
			hideLoading();
        }).catch( err => show404() );

        function initTestApp (testJSON){
			const testApp = new Test(testJSON);
			testApp.display();
			document.querySelector("button#next-question").addEventListener("click", e => {
				testApp.showNextQuestion();
			});
			document.querySelector("button#prev-question").addEventListener("click", e => {
				testApp.showPreviousQuestion();
			});
			document.getElementById("submit-for-evaluation").addEventListener("click", e => {
				// check if all the questions are checked				
				const allChecked = (testApp.calcCheckedQuestions() == 100);

				// if all qns are checked, evaluate test
				if (allChecked) testApp.showResults()

				// if not alert the user that not all qns are answered
				if (!allChecked){
					document.querySelector(".paginator-wrapper").classList.add("show-evaluation-confirmation");
				}
			});

			document.getElementById("highlight-unanswered").addEventListener("change", 
				e => testApp.highlightUnansweredQns(e.target.checked));

			document.getElementById("confirm-submition").addEventListener("click", e => {
				// if the user still wants to proceed, evalute
				testApp.showResults();
			});
			document.getElementById("cancel-submition").addEventListener("click", e => {
				// if he cancels eval, then show the paginator
				document.querySelector(".paginator-wrapper").classList.remove("show-evaluation-confirmation");
			});


			document.getElementById("show-full-report").addEventListener("click", e => {
				testApp.showReport();
			});
        }

        function show404(){
        	window.location.href = "../404.html";
        }


        function retakeTest(){
        	window.location.reload();
        }

        function takeDifferentTest(){
        	window.location.href = "../";
        }

        function hideFullReport(){
        	const reportWrapper = document.querySelector(".full-report-wrapper");
        	reportWrapper.classList.remove("show");
			var reportNode = reportWrapper.querySelector(".full-report");
			while (reportNode.firstChild) {
			    reportNode.removeChild(reportNode.firstChild);
			}
        }
	</script>
</body>

</html>